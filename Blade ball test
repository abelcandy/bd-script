--[[
    Death Ball Roblox Exploit GUI Script - DELTA EXECUTOR VERSION v2.0
    Features: Auto Parry, ESP View, ESP Line
    GUI Library: Roblox ScreenGui (nativo)
    Date: 2026-02-14
    Otimizado para Delta Executor
    Melhorias: Keybind, Anima√ß√µes no Mouse, Separa√ß√£o Enable/Disable
]]--

-- ============================================================================
-- CONFIGURA√á√ÉO
-- ============================================================================

local CONFIG = {
    -- Configura√ß√µes do Painel
    PANEL_WIDTH = 350,
    PANEL_HEIGHT = 480,
    PANEL_X = 50,
    PANEL_Y = 50,
    
    -- Cores
    ACCENT_COLOR = Color3.fromRGB(255, 100, 50),
    TEXT_COLOR = Color3.fromRGB(255, 255, 255),
    BG_COLOR = Color3.fromRGB(25, 25, 35),
    BUTTON_COLOR = Color3.fromRGB(50, 50, 70),
    SUCCESS_COLOR = Color3.fromRGB(50, 200, 100),
    HOVER_COLOR = Color3.fromRGB(100, 150, 200),
    
    -- Death Ball
    PARRY_RANGE = 100,
    PARRY_COOLDOWN = 0.3,
    BALL_DETECTION_RANGE = 150,
    MAX_ESP_DISTANCE = 500,
    
    -- Keybind
    TOGGLE_PANEL_KEY = Enum.KeyCode.B,
}

-- ============================================================================
-- ESTADO DO SCRIPT
-- ============================================================================

local ScriptState = {
    AutoParryEnabled = false,
    ESPViewEnabled = false,
    ESPLineEnabled = false,
    PanelVisible = true,
    LastParryTime = 0,
    ESPDrawings = {},
    IsDragging = false,
    DragOffset = {X = 0, Y = 0},
    ParryAttempts = 0,
    ParrySuccesses = 0,
}

-- ============================================================================
-- FUN√á√ïES UTILIT√ÅRIAS
-- ============================================================================

local function SafeCall(func)
    local success, result = pcall(func)
    if not success then
        warn("[Erro] " .. tostring(result))
    end
    return success, result
end

local function GetLocalPlayer()
    return game.Players.LocalPlayer
end

local function GetLocalCharacter()
    local player = GetLocalPlayer()
    return player and player.Character or nil
end

local function GetHumanoidRootPart()
    local character = GetLocalCharacter()
    if character then
        return character:FindFirstChild("HumanoidRootPart")
    end
    return nil
end

local function GetHumanoid()
    local character = GetLocalCharacter()
    if character then
        return character:FindFirstChild("Humanoid")
    end
    return nil
end

local function CleanupESP()
    SafeCall(function()
        for _, drawing in pairs(ScriptState.ESPDrawings) do
            if drawing then
                drawing:Destroy()
            end
        end
        ScriptState.ESPDrawings = {}
    end)
end

-- Fun√ß√£o para criar anima√ß√£o de hover
local function CreateHoverAnimation(element, originalColor, hoverColor)
    local tweenService = game:GetService("TweenService")
    
    element.MouseEnter:Connect(function()
        local tweenInfo = TweenInfo.new(
            0.2,
            Enum.EasingStyle.Quad,
            Enum.EasingDirection.Out
        )
        
        local tween = tweenService:Create(element, tweenInfo, {BackgroundColor3 = hoverColor})
        tween:Play()
    end)
    
    element.MouseLeave:Connect(function()
        local tweenInfo = TweenInfo.new(
            0.2,
            Enum.EasingStyle.Quad,
            Enum.EasingDirection.Out
        )
        
        local tween = tweenService:Create(element, tweenInfo, {BackgroundColor3 = originalColor})
        tween:Play()
    end)
end

-- ============================================================================
-- DETEC√á√ÉO DE BOLAS E AUTO PARRY
-- ============================================================================

local function DetectIncomingBalls()
    local detectedBalls = {}
    
    SafeCall(function()
        local character = GetLocalCharacter()
        if not character then return end
        
        local hrp = GetHumanoidRootPart()
        if not hrp then return end

        -- Procura por bolas no workspace
        for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("BasePart") then
                local name = obj.Name:lower()
                
                -- Padr√µes comuns de nome para Death Ball
                if name:match("ball") or name:match("death") or name:match("projectile") then
                    local distance = (obj.Position - hrp.Position).Magnitude
                    
                    if distance <= CONFIG.BALL_DETECTION_RANGE then
                        if obj:FindFirstChild("BodyVelocity") or obj.Velocity.Magnitude > 1 then
                            table.insert(detectedBalls, {
                                Object = obj,
                                Distance = distance,
                                Velocity = obj.Velocity,
                            })
                        end
                    end
                end
            end
        end
    end)

    table.sort(detectedBalls, function(a, b) return a.Distance < b.Distance end)
    return detectedBalls
end

local function ShouldParry(ball)
    if not ball then return false end
    
    local hrp = GetHumanoidRootPart()
    if not hrp then return false end

    local ballToPlayer = hrp.Position - ball.Object.Position
    local ballVelocity = ball.Object.Velocity
    
    if ballVelocity.Magnitude == 0 then return false end
    
    local ballDirection = ballVelocity.Unit
    local ballDirAlignment = ballToPlayer.Unit:Dot(ballDirection)
    
    return ballDirAlignment > 0.3
end

local function PerformParry()
    SafeCall(function()
        local currentTime = tick()
        if currentTime - ScriptState.LastParryTime < CONFIG.PARRY_COOLDOWN then
            return
        end

        local userInputService = game:GetService("UserInputService")
        if not userInputService then return end

        -- Simula press√£o da tecla F (parry padr√£o)
        keypress(string.byte("f"))
        
        ScriptState.LastParryTime = currentTime
        ScriptState.ParryAttempts = ScriptState.ParryAttempts + 1
    end)
end

local function AutoParryLogic()
    if not ScriptState.AutoParryEnabled then return end

    SafeCall(function()
        local character = GetLocalCharacter()
        if not character or not GetHumanoidRootPart() then return end

        local detectedBalls = DetectIncomingBalls()
        
        if #detectedBalls > 0 then
            local closestBall = detectedBalls[1]
            if ShouldParry(closestBall) then
                PerformParry()
            end
        end
    end)
end

-- ============================================================================
-- FUNCIONALIDADE ESP
-- ============================================================================

local function GetPlayersForESP()
    local players = {}
    SafeCall(function()
        local localPlayer = GetLocalPlayer()
        local character = GetLocalCharacter()
        
        if not character then return end

        for _, player in pairs(game.Players:GetPlayers()) do
            if player ~= localPlayer and player.Character then
                local otherHRP = player.Character:FindFirstChild("HumanoidRootPart")
                local otherHumanoid = player.Character:FindFirstChild("Humanoid")
                
                if otherHRP and otherHumanoid and otherHumanoid.Health > 0 then
                    table.insert(players, {
                        Player = player,
                        Character = player.Character,
                        HRP = otherHRP,
                        Humanoid = otherHumanoid,
                        Name = player.Name,
                    })
                end
            end
        end
    end)
    
    return players
end

local function CreateESPLabel(player, hrp)
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "ESP_" .. player.Name
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

    local label = Instance.new("TextLabel")
    label.Name = "ESPLabel_" .. player.Name
    label.BackgroundColor3 = CONFIG.BG_COLOR
    label.BackgroundTransparency = 0.3
    label.TextColor3 = CONFIG.ACCENT_COLOR
    label.TextSize = 14
    label.Font = Enum.Font.GothamBold
    label.Size = UDim2.new(0, 120, 0, 50)
    label.Parent = screenGui

    -- Atualiza posi√ß√£o baseado na camera
    local camera = workspace.CurrentCamera
    
    local function UpdatePosition()
        SafeCall(function()
            if not hrp or not hrp.Parent then
                screenGui:Destroy()
                return
            end

            local screenPos, onScreen = camera:WorldToScreenPoint(hrp.Position)
            
            if onScreen then
                label.Visible = true
                label.Position = UDim2.new(0, screenPos.X - 60, 0, screenPos.Y - 25)
                
                local distance = (hrp.Position - GetHumanoidRootPart().Position).Magnitude
                local humanoid = hrp.Parent:FindFirstChild("Humanoid")
                local health = humanoid and humanoid.Health or 0
                local maxHealth = humanoid and humanoid.MaxHealth or 100
                
                label.Text = player.Name .. "\n[" .. tostring(math.floor(distance)) .. "m]\nHP: " .. tostring(math.floor(health))
            else
                label.Visible = false
            end
        end)
    end

    -- Conex√£o para atualizar continuamente
    local connection
    connection = game:GetService("RunService").RenderStepped:Connect(function()
        if not screenGui.Parent then
            connection:Disconnect()
            return
        end
        UpdatePosition()
    end)

    return screenGui
end

local function UpdateESPDrawings()
    if not (ScriptState.ESPViewEnabled or ScriptState.ESPLineEnabled) then
        CleanupESP()
        return
    end

    SafeCall(function()
        local localHRP = GetHumanoidRootPart()
        if not localHRP then
            CleanupESP()
            return
        end

        local players = GetPlayersForESP()

        for _, playerData in pairs(players) do
            local otherHRP = playerData.HRP
            local distance = (otherHRP.Position - localHRP.Position).Magnitude

            if distance <= CONFIG.MAX_ESP_DISTANCE then
                if ScriptState.ESPViewEnabled then
                    -- Cria label ESP para o jogador
                    local existingLabel = game.Players.LocalPlayer.PlayerGui:FindFirstChild("ESP_" .. playerData.Name)
                    if not existingLabel then
                        local espGui = CreateESPLabel(playerData.Player, otherHRP)
                        table.insert(ScriptState.ESPDrawings, espGui)
                    end
                end

                if ScriptState.ESPLineEnabled then
                    -- Cria linha de conex√£o (usando BillboardGui)
                    local lineGui = Instance.new("ScreenGui")
                    lineGui.Name = "ESPLine_" .. playerData.Name
                    lineGui.ResetOnSpawn = false
                    lineGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
                    lineGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

                    local frame = Instance.new("Frame")
                    frame.Name = "Line"
                    frame.BackgroundColor3 = CONFIG.ACCENT_COLOR
                    frame.BorderSizePixel = 0
                    frame.BackgroundTransparency = 0.3
                    frame.Parent = lineGui

                    local camera = workspace.CurrentCamera
                    
                    local function UpdateLine()
                        SafeCall(function()
                            if not localHRP or not otherHRP or not localHRP.Parent or not otherHRP.Parent then
                                lineGui:Destroy()
                                return
                            end

                            local playerScreenPos, playerOnScreen = camera:WorldToScreenPoint(localHRP.Position)
                            local targetScreenPos, targetOnScreen = camera:WorldToScreenPoint(otherHRP.Position)
                            
                            if playerOnScreen and targetOnScreen then
                                local dx = targetScreenPos.X - playerScreenPos.X
                                local dy = targetScreenPos.Y - playerScreenPos.Y
                                local distance = math.sqrt(dx * dx + dy * dy)
                                local angle = math.atan2(dy, dx)

                                frame.Size = UDim2.new(0, distance, 0, 2)
                                frame.Position = UDim2.new(0, playerScreenPos.X, 0, playerScreenPos.Y)
                                frame.Rotation = math.deg(angle)
                                frame.Visible = true
                            else
                                frame.Visible = false
                            end
                        end)
                    end

                    local connection
                    connection = game:GetService("RunService").RenderStepped:Connect(function()
                        if not lineGui.Parent then
                            connection:Disconnect()
                            return
                        end
                        UpdateLine()
                    end)

                    table.insert(ScriptState.ESPDrawings, lineGui)
                end
            end
        end
    end)
end

-- ============================================================================
-- CRIA√á√ÉO DA GUI
-- ============================================================================

local function CreateUI()
    local playerGui = GetLocalPlayer():WaitForChild("PlayerGui")

    -- ScreenGui Principal
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "DeathBallExploit"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.Parent = playerGui

    -- Painel Principal
    local mainPanel = Instance.new("Frame")
    mainPanel.Name = "MainPanel"
    mainPanel.BackgroundColor3 = CONFIG.BG_COLOR
    mainPanel.BackgroundTransparency = 0.1
    mainPanel.BorderSizePixel = 0
    mainPanel.Size = UDim2.new(0, CONFIG.PANEL_WIDTH, 0, CONFIG.PANEL_HEIGHT)
    mainPanel.Position = UDim2.new(0, CONFIG.PANEL_X, 0, CONFIG.PANEL_Y)
    mainPanel.Parent = screenGui

    -- Cantos arredondados
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = mainPanel

    -- Barra de T√≠tulo
    local titleBar = Instance.new("Frame")
    titleBar.Name = "TitleBar"
    titleBar.BackgroundColor3 = CONFIG.ACCENT_COLOR
    titleBar.BackgroundTransparency = 0.2
    titleBar.BorderSizePixel = 0
    titleBar.Size = UDim2.new(1, 0, 0, 45)
    titleBar.Parent = mainPanel

    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 10)
    titleCorner.Parent = titleBar

    -- Texto do T√≠tulo
    local titleText = Instance.new("TextLabel")
    titleText.Name = "TitleText"
    titleText.BackgroundTransparency = 1
    titleText.TextColor3 = CONFIG.TEXT_COLOR
    titleText.TextSize = 18
    titleText.Font = Enum.Font.GothamBold
    titleText.Size = UDim2.new(0.7, 0, 1, 0)
    titleText.Text = "‚öΩ Death Ball Menu"
    titleText.Parent = titleBar

    -- Texto Keybind
    local keyBindText = Instance.new("TextLabel")
    keyBindText.Name = "KeyBindText"
    keyBindText.BackgroundTransparency = 1
    keyBindText.TextColor3 = CONFIG.SUCCESS_COLOR
    keyBindText.TextSize = 11
    keyBindText.Font = Enum.Font.Gotham
    keyBindText.Size = UDim2.new(0.3, 0, 0.5, 0)
    keyBindText.Position = UDim2.new(0, 10, 0.5, 0)
    keyBindText.Text = "Press B to toggle"
    keyBindText.Parent = titleBar

    -- Bot√£o Fechar
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
    closeButton.BackgroundTransparency = 0.2
    closeButton.TextColor3 = CONFIG.TEXT_COLOR
    closeButton.TextSize = 16
    closeButton.Font = Enum.Font.GothamBold
    closeButton.Text = "X"
    closeButton.BorderSizePixel = 0
    closeButton.Size = UDim2.new(0, 35, 0, 35)
    closeButton.Position = UDim2.new(1, -40, 0.5, -17.5)
    closeButton.Parent = titleBar

    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 5)
    closeCorner.Parent = closeButton

    CreateHoverAnimation(closeButton, Color3.fromRGB(220, 50, 50), Color3.fromRGB(255, 100, 100))

    -- Container de Toggles
    local toggleContainer = Instance.new("Frame")
    toggleContainer.Name = "ToggleContainer"
    toggleContainer.BackgroundTransparency = 1
    toggleContainer.BorderSizePixel = 0
    toggleContainer.Size = UDim2.new(1, -20, 0, 380)
    toggleContainer.Position = UDim2.new(0, 10, 0, 55)
    toggleContainer.Parent = mainPanel

    -- Lista de Features
    local features = {
        {name = "üîÑ Auto Parry", key = "AutoParry"},
        {name = "üëÅÔ∏è ESP View", key = "ESPView"},
        {name = "üìç ESP Line", key = "ESPLine"},
    }

    local toggleFrames = {}

    for idx, feature in ipairs(features) do
        local featureFrame = Instance.new("Frame")
        featureFrame.Name = feature.key .. "_Frame"
        featureFrame.BackgroundColor3 = CONFIG.BUTTON_COLOR
        featureFrame.BackgroundTransparency = 0.3
        featureFrame.BorderSizePixel = 0
        featureFrame.Size = UDim2.new(1, 0, 0, 95)
        featureFrame.Position = UDim2.new(0, 0, 0, (idx - 1) * 100)
        featureFrame.Parent = toggleContainer

        local frameCorner = Instance.new("UICorner")
        frameCorner.CornerRadius = UDim.new(0, 8)
        frameCorner.Parent = featureFrame

        -- Label principal
        local label = Instance.new("TextLabel")
        label.Name = "Label"
        label.BackgroundTransparency = 1
        label.TextColor3 = CONFIG.TEXT_COLOR
        label.TextSize = 16
        label.Font = Enum.Font.GothamBold
        label.Size = UDim2.new(0.5, 0, 0.4, 0)
        label.Position = UDim2.new(0, 15, 0, 8)
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.Text = feature.name
        label.Parent = featureFrame

        -- Bot√£o ATIVAR (Enable)
        local enableButton = Instance.new("TextButton")
        enableButton.Name = "EnableButton"
        enableButton.BackgroundColor3 = CONFIG.SUCCESS_COLOR
        enableButton.BackgroundTransparency = 0.2
        enableButton.TextColor3 = CONFIG.TEXT_COLOR
        enableButton.TextSize = 12
        enableButton.Font = Enum.Font.GothamBold
        enableButton.Text = "‚úì ATIVAR"
        enableButton.BorderSizePixel = 0
        enableButton.Size = UDim2.new(0, 110, 0, 35)
        enableButton.Position = UDim2.new(1, -245, 0, 8)
        enableButton.Parent = featureFrame

        local enableCorner = Instance.new("UICorner")
        enableCorner.CornerRadius = UDim.new(0, 6)
        enableCorner.Parent = enableButton

        -- Bot√£o DESATIVAR (Disable)
        local disableButton = Instance.new("TextButton")
        disableButton.Name = "DisableButton"
        disableButton.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
        disableButton.BackgroundTransparency = 0.3
        disableButton.TextColor3 = CONFIG.TEXT_COLOR
        disableButton.TextSize = 12
        disableButton.Font = Enum.Font.GothamBold
        disableButton.Text = "‚úï DESATIVAR"
        disableButton.BorderSizePixel = 0
        disableButton.Size = UDim2.new(0, 120, 0, 35)
        disableButton.Position = UDim2.new(1, -120, 0, 8)
        disableButton.Parent = featureFrame

        local disableCorner = Instance.new("UICorner")
        disableCorner.CornerRadius = UDim.new(0, 6)
        disableCorner.Parent = disableButton

        -- Status label
        local statusLabel = Instance.new("TextLabel")
        statusLabel.Name = "StatusLabel"
        statusLabel.BackgroundTransparency = 1
        statusLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
        statusLabel.TextSize = 12
        statusLabel.Font = Enum.Font.Gotham
        statusLabel.Size = UDim2.new(1, -30, 0.4, 0)
        statusLabel.Position = UDim2.new(0, 15, 0.5, 0)
        statusLabel.TextXAlignment = Enum.TextXAlignment.Left
        statusLabel.Text = "Status: DESLIGADO"
        statusLabel.Parent = featureFrame

        -- Anima√ß√µes dos bot√µes
        CreateHoverAnimation(enableButton, CONFIG.SUCCESS_COLOR, Color3.fromRGB(100, 255, 100))
        CreateHoverAnimation(disableButton, Color3.fromRGB(220, 50, 50), Color3.fromRGB(255, 100, 100))

        -- Vari√°vel de estado
        local isEnabled = false

        -- Fun√ß√£o para atualizar visual
        local function UpdateStatus()
            if isEnabled then
                statusLabel.Text = "Status: ‚úì ATIVADO"
                statusLabel.TextColor3 = CONFIG.SUCCESS_COLOR
            else
                statusLabel.Text = "Status: ‚úï DESLIGADO"
                statusLabel.TextColor3 = Color3.fromRGB(150, 100, 100)
            end
        end

        -- Evento ATIVAR
        enableButton.MouseButton1Click:Connect(function()
            isEnabled = true
            UpdateStatus()

            if feature.key == "AutoParry" then
                ScriptState.AutoParryEnabled = true
            elseif feature.key == "ESPView" then
                ScriptState.ESPViewEnabled = true
            elseif feature.key == "ESPLine" then
                ScriptState.ESPLineEnabled = true
            end
        end)

        -- Evento DESATIVAR
        disableButton.MouseButton1Click:Connect(function()
            isEnabled = false
            UpdateStatus()

            if feature.key == "AutoParry" then
                ScriptState.AutoParryEnabled = false
            elseif feature.key == "ESPView" then
                ScriptState.ESPViewEnabled = false
            elseif feature.key == "ESPLine" then
                ScriptState.ESPLineEnabled = false
            end
        end)

        UpdateStatus()

        table.insert(toggleFrames, {
            Frame = featureFrame,
            EnableButton = enableButton,
            DisableButton = disableButton,
            StatusLabel = statusLabel,
            IsEnabled = function() return isEnabled end,
            SetEnabled = function(value)
                isEnabled = value
                UpdateStatus()
            end
        })
    end

    -- Status Text Bottom
    local statusText = Instance.new("TextLabel")
    statusText.Name = "StatusText"
    statusText.BackgroundTransparency = 1
    statusText.TextColor3 = CONFIG.SUCCESS_COLOR
    statusText.TextSize = 11
    statusText.Font = Enum.Font.Gotham
    statusText.Size = UDim2.new(1, -20, 0, 50)
    statusText.Position = UDim2.new(0, 10, 1, -60)
    statusText.Text = "‚úì Script Carregado com Sucesso!\nPressione 'B' para abrir/fechar"
    statusText.TextWrapped = true
    statusText.Parent = mainPanel

    -- Drag functionality
    local dragging = false
    local dragStart = Vector2.new(0, 0)
    local startPos = mainPanel.Position

    titleBar.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = game:GetService("UserInputService"):GetMouseLocation()
            startPos = mainPanel.Position
        end
    end)

    titleBar.InputEnded:Connect(function(input, gameProcessed)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)

    game:GetService("UserInputService").InputChanged:Connect(function(input, gameProcessed)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local currentMouse = game:GetService("UserInputService"):GetMouseLocation()
            local delta = currentMouse - dragStart
            mainPanel.Position = UDim2.new(0, startPos.X.Offset + delta.X, 0, startPos.Y.Offset + delta.Y)
        end
    end)

    -- Close button functionality
    closeButton.MouseButton1Click:Connect(function()
        screenGui.Visible = false
        ScriptState.PanelVisible = false
    end)

    -- Atualizar status em tempo real
    local updateStatus = game:GetService("RunService").Heartbeat:Connect(function()
        local parryStatus = ScriptState.AutoParryEnabled and "ATIVADO" or "DESLIGADO"
        local espViewStatus = ScriptState.ESPViewEnabled and "ATIVADO" or "DESLIGADO"
        local espLineStatus = ScriptState.ESPLineEnabled and "ATIVADO" or "DESLIGADO"

        statusText.Text = string.format(
            "üîÑ Parry: %s\nüëÅÔ∏è ESP View: %s\nüìç ESP Line: %s",
            parryStatus, espViewStatus, espLineStatus
        )
    end)

    return screenGui, updateStatus, mainPanel
end

-- ============================================================================
-- KEYBIND PARA ABRIR/FECHAR PAINEL
-- ============================================================================

local screenGui, statusConnection, mainPanel = nil, nil, nil

local function SetupKeybind()
    local userInputService = game:GetService("UserInputService")
    
    userInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        if input.KeyCode == CONFIG.TOGGLE_PANEL_KEY then
            if mainPanel then
                ScriptState.PanelVisible = not ScriptState.PanelVisible
                mainPanel.Visible = ScriptState.PanelVisible
            end
        end
    end)
end

-- ============================================================================
-- MAIN LOOP
-- ============================================================================

local function MainLoop()
    while true do
        SafeCall(function()
            AutoParryLogic()
            UpdateESPDrawings()
        end)
        wait(0.1)
    end
end

-- ============================================================================
-- INICIALIZA√á√ÉO
-- ============================================================================

if not game:IsLoaded() then
    game.Loaded:Wait()
end

wait(2) -- Aguarda jogo carregar completamente

print("‚úì Iniciando Death Ball Script para Delta Executor v2.0...")

screenGui, statusConnection, mainPanel = CreateUI()

print("‚úì GUI criada com sucesso!")
print("‚úì Recursos dispon√≠veis: Auto Parry, ESP View, ESP Line")
print("‚úì Keybind: Pressione 'B' para abrir/fechar o painel")
print("‚úì O painel √© arrast√°vel pela barra de t√≠tulo!")

-- Setup keybind
SetupKeybind()

-- Inicia main loop
task.spawn(MainLoop)

print("‚úì Death Ball Script v2.0 carregado com sucesso!")

-- Cleanup
game.Players.LocalPlayer.CharacterAdded:Connect(function()
    CleanupESP()
end)
