--[[
    Death Ball Roblox Exploit GUI Script - DELTA EXECUTOR VERSION v3.0
    Features: Auto Parry, ESP View, ESP Line
    GUI Library: Roblox ScreenGui (nativo)
    Date: 2026-02-14
    Otimizado para Delta Executor
    Design: Inspirado em painel moderno com sidebar
]]--

-- ============================================================================
-- CONFIGURA√á√ÉO
-- ============================================================================

local CONFIG = {
    -- Configura√ß√µes do Painel
    MAIN_PANEL_WIDTH = 600,
    MAIN_PANEL_HEIGHT = 450,
    SIDEBAR_WIDTH = 150,
    PANEL_X = 50,
    PANEL_Y = 50,
    
    -- Cores
    SIDEBAR_COLOR = Color3.fromRGB(20, 20, 25),
    MAIN_BG_COLOR = Color3.fromRGB(30, 30, 40),
    HEADER_COLOR = Color3.fromRGB(15, 15, 20),
    BUTTON_COLOR = Color3.fromRGB(50, 50, 70),
    BUTTON_HOVER_COLOR = Color3.fromRGB(70, 70, 100),
    ACCENT_COLOR = Color3.fromRGB(255, 100, 50),
    BUTTON_ACCENT_COLOR = Color3.fromRGB(220, 50, 50),
    TEXT_COLOR = Color3.fromRGB(200, 200, 200),
    TEXT_TITLE = Color3.fromRGB(255, 255, 255),
    SUCCESS_COLOR = Color3.fromRGB(50, 200, 100),
    
    -- Death Ball
    PARRY_RANGE = 100,
    PARRY_COOLDOWN = 0.3,
    BALL_DETECTION_RANGE = 150,
    MAX_ESP_DISTANCE = 500,
    
    -- Keybind
    TOGGLE_PANEL_KEY = Enum.KeyCode.B,
}

-- ============================================================================
-- ESTADO DO SCRIPT
-- ============================================================================

local ScriptState = {
    AutoParryEnabled = false,
    ESPViewEnabled = false,
    ESPLineEnabled = false,
    PanelVisible = true,
    LastParryTime = 0,
    ESPDrawings = {},
    IsDragging = false,
    DragOffset = {X = 0, Y = 0},
    ParryAttempts = 0,
    CurrentTab = "Home",
}

-- ============================================================================
-- FUN√á√ïES UTILIT√ÅRIAS
-- ============================================================================

local function SafeCall(func)
    local success, result = pcall(func)
    if not success then
        warn("[Erro] " .. tostring(result))
    end
    return success, result
end

local function GetLocalPlayer()
    return game.Players.LocalPlayer
end

local function GetLocalCharacter()
    local player = GetLocalPlayer()
    return player and player.Character or nil
end

local function GetHumanoidRootPart()
    local character = GetLocalCharacter()
    if character then
        return character:FindFirstChild("HumanoidRootPart")
    end
    return nil
end

local function GetHumanoid()
    local character = GetLocalCharacter()
    if character then
        return character:FindFirstChild("Humanoid")
    end
    return nil
end

local function CleanupESP()
    SafeCall(function()
        for _, drawing in pairs(ScriptState.ESPDrawings) do
            if drawing then
                drawing:Destroy()
            end
        end
        ScriptState.ESPDrawings = {}
    end)
end

-- Fun√ß√£o para criar anima√ß√£o de hover
local function CreateHoverAnimation(element, originalColor, hoverColor)
    local tweenService = game:GetService("TweenService")
    
    element.MouseEnter:Connect(function()
        local tweenInfo = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local tween = tweenService:Create(element, tweenInfo, {BackgroundColor3 = hoverColor})
        tween:Play()
    end)
    
    element.MouseLeave:Connect(function()
        local tweenInfo = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local tween = tweenService:Create(element, tweenInfo, {BackgroundColor3 = originalColor})
        tween:Play()
    end)
end

-- ============================================================================
-- DETEC√á√ÉO DE BOLAS E AUTO PARRY
-- ============================================================================

local function DetectIncomingBalls()
    local detectedBalls = {}
    
    SafeCall(function()
        local character = GetLocalCharacter()
        if not character then return end
        
        local hrp = GetHumanoidRootPart()
        if not hrp then return end

        for _, obj in pairs(workspace:GetDescendants()) do
            if obj:IsA("BasePart") then
                local name = obj.Name:lower()
                
                if name:match("ball") or name:match("death") or name:match("projectile") then
                    local distance = (obj.Position - hrp.Position).Magnitude
                    
                    if distance <= CONFIG.BALL_DETECTION_RANGE then
                        if obj:FindFirstChild("BodyVelocity") or obj.Velocity.Magnitude > 1 then
                            table.insert(detectedBalls, {
                                Object = obj,
                                Distance = distance,
                                Velocity = obj.Velocity,
                            })
                        end
                    end
                end
            end
        end
    end)

    table.sort(detectedBalls, function(a, b) return a.Distance < b.Distance end)
    return detectedBalls
end

local function ShouldParry(ball)
    if not ball then return false end
    
    local hrp = GetHumanoidRootPart()
    if not hrp then return false end

    local ballToPlayer = hrp.Position - ball.Object.Position
    local ballVelocity = ball.Object.Velocity
    
    if ballVelocity.Magnitude == 0 then return false end
    
    local ballDirection = ballVelocity.Unit
    local ballDirAlignment = ballToPlayer.Unit:Dot(ballDirection)
    
    return ballDirAlignment > 0.3
end

local function PerformParry()
    SafeCall(function()
        local currentTime = tick()
        if currentTime - ScriptState.LastParryTime < CONFIG.PARRY_COOLDOWN then
            return
        end

        keypress(string.byte("f"))
        
        ScriptState.LastParryTime = currentTime
        ScriptState.ParryAttempts = ScriptState.ParryAttempts + 1
    end)
end

local function AutoParryLogic()
    if not ScriptState.AutoParryEnabled then return end

    SafeCall(function()
        local character = GetLocalCharacter()
        if not character or not GetHumanoidRootPart() then return end

        local detectedBalls = DetectIncomingBalls()
        
        if #detectedBalls > 0 then
            local closestBall = detectedBalls[1]
            if ShouldParry(closestBall) then
                PerformParry()
            end
        end
    end)
end

-- ============================================================================
-- FUNCIONALIDADE ESP
-- ============================================================================

local function GetPlayersForESP()
    local players = {}
    SafeCall(function()
        local localPlayer = GetLocalPlayer()
        local character = GetLocalCharacter()
        
        if not character then return end

        for _, player in pairs(game.Players:GetPlayers()) do
            if player ~= localPlayer and player.Character then
                local otherHRP = player.Character:FindFirstChild("HumanoidRootPart")
                local otherHumanoid = player.Character:FindFirstChild("Humanoid")
                
                if otherHRP and otherHumanoid and otherHumanoid.Health > 0 then
                    table.insert(players, {
                        Player = player,
                        Character = player.Character,
                        HRP = otherHRP,
                        Humanoid = otherHumanoid,
                        Name = player.Name,
                    })
                end
            end
        end
    end)
    
    return players
end

local function CreateESPLabel(player, hrp)
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "ESP_" .. player.Name
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

    local label = Instance.new("TextLabel")
    label.Name = "ESPLabel_" .. player.Name
    label.BackgroundColor3 = CONFIG.MAIN_BG_COLOR
    label.BackgroundTransparency = 0.3
    label.TextColor3 = CONFIG.ACCENT_COLOR
    label.TextSize = 14
    label.Font = Enum.Font.GothamBold
    label.Size = UDim2.new(0, 120, 0, 50)
    label.Parent = screenGui

    local camera = workspace.CurrentCamera
    
    local function UpdatePosition()
        SafeCall(function()
            if not hrp or not hrp.Parent then
                screenGui:Destroy()
                return
            end

            local screenPos, onScreen = camera:WorldToScreenPoint(hrp.Position)
            
            if onScreen then
                label.Visible = true
                label.Position = UDim2.new(0, screenPos.X - 60, 0, screenPos.Y - 25)
                
                local distance = (hrp.Position - GetHumanoidRootPart().Position).Magnitude
                local humanoid = hrp.Parent:FindFirstChild("Humanoid")
                local health = humanoid and humanoid.Health or 0
                local maxHealth = humanoid and humanoid.MaxHealth or 100
                
                label.Text = player.Name .. "\n[" .. tostring(math.floor(distance)) .. "m]\nHP: " .. tostring(math.floor(health))
            else
                label.Visible = false
            end
        end)
    end

    local connection
    connection = game:GetService("RunService").RenderStepped:Connect(function()
        if not screenGui.Parent then
            connection:Disconnect()
            return
        end
        UpdatePosition()
    end)

    return screenGui
end

local function UpdateESPDrawings()
    if not (ScriptState.ESPViewEnabled or ScriptState.ESPLineEnabled) then
        CleanupESP()
        return
    end

    SafeCall(function()
        local localHRP = GetHumanoidRootPart()
        if not localHRP then
            CleanupESP()
            return
        end

        local players = GetPlayersForESP()

        for _, playerData in pairs(players) do
            local otherHRP = playerData.HRP
            local distance = (otherHRP.Position - localHRP.Position).Magnitude

            if distance <= CONFIG.MAX_ESP_DISTANCE then
                if ScriptState.ESPViewEnabled then
                    local existingLabel = game.Players.LocalPlayer.PlayerGui:FindFirstChild("ESP_" .. playerData.Name)
                    if not existingLabel then
                        local espGui = CreateESPLabel(playerData.Player, otherHRP)
                        table.insert(ScriptState.ESPDrawings, espGui)
                    end
                end

                if ScriptState.ESPLineEnabled then
                    local lineGui = Instance.new("ScreenGui")
                    lineGui.Name = "ESPLine_" .. playerData.Name
                    lineGui.ResetOnSpawn = false
                    lineGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
                    lineGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

                    local frame = Instance.new("Frame")
                    frame.Name = "Line"
                    frame.BackgroundColor3 = CONFIG.ACCENT_COLOR
                    frame.BorderSizePixel = 0
                    frame.BackgroundTransparency = 0.3
                    frame.Parent = lineGui

                    local camera = workspace.CurrentCamera
                    
                    local function UpdateLine()
                        SafeCall(function()
                            if not localHRP or not otherHRP or not localHRP.Parent or not otherHRP.Parent then
                                lineGui:Destroy()
                                return
                            end

                            local playerScreenPos, playerOnScreen = camera:WorldToScreenPoint(localHRP.Position)
                            local targetScreenPos, targetOnScreen = camera:WorldToScreenPoint(otherHRP.Position)
                            
                            if playerOnScreen and targetOnScreen then
                                local dx = targetScreenPos.X - playerScreenPos.X
                                local dy = targetScreenPos.Y - playerScreenPos.Y
                                local distance = math.sqrt(dx * dx + dy * dy)
                                local angle = math.atan2(dy, dx)

                                frame.Size = UDim2.new(0, distance, 0, 2)
                                frame.Position = UDim2.new(0, playerScreenPos.X, 0, playerScreenPos.Y)
                                frame.Rotation = math.deg(angle)
                                frame.Visible = true
                            else
                                frame.Visible = false
                            end
                        end)
                    end

                    local connection
                    connection = game:GetService("RunService").RenderStepped:Connect(function()
                        if not lineGui.Parent then
                            connection:Disconnect()
                            return
                        end
                        UpdateLine()
                    end)

                    table.insert(ScriptState.ESPDrawings, lineGui)
                end
            end
        end
    end)
end

-- ============================================================================
-- CRIA√á√ÉO DA GUI - NOVO DESIGN
-- ============================================================================

local function CreateUI()
    local playerGui = GetLocalPlayer():WaitForChild("PlayerGui")

    -- ScreenGui Principal
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "DeathBallExploit"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.Parent = playerGui

    -- Painel Principal (Com Sidebar)
    local mainPanel = Instance.new("Frame")
    mainPanel.Name = "MainPanel"
    mainPanel.BackgroundColor3 = CONFIG.MAIN_BG_COLOR
    mainPanel.BackgroundTransparency = 0.05
    mainPanel.BorderSizePixel = 2
    mainPanel.BorderColor3 = CONFIG.ACCENT_COLOR
    mainPanel.Size = UDim2.new(0, CONFIG.MAIN_PANEL_WIDTH, 0, CONFIG.MAIN_PANEL_HEIGHT)
    mainPanel.Position = UDim2.new(0, CONFIG.PANEL_X, 0, CONFIG.PANEL_Y)
    mainPanel.Parent = screenGui

    -- ========== HEADER ==========
    local header = Instance.new("Frame")
    header.Name = "Header"
    header.BackgroundColor3 = CONFIG.HEADER_COLOR
    header.BorderSizePixel = 0
    header.Size = UDim2.new(1, 0, 0, 50)
    header.Parent = mainPanel

    -- Logo/Version
    local versionLabel = Instance.new("TextLabel")
    versionLabel.BackgroundTransparency = 1
    versionLabel.TextColor3 = CONFIG.TEXT_COLOR
    versionLabel.TextSize = 13
    versionLabel.Font = Enum.Font.GothamBold
    versionLabel.Text = "v3.0.0"
    versionLabel.Size = UDim2.new(0, 80, 1, 0)
    versionLabel.Position = UDim2.new(0, 10, 0, 0)
    versionLabel.TextXAlignment = Enum.TextXAlignment.Left
    versionLabel.Parent = header

    -- T√≠tulo
    local titleLabel = Instance.new("TextLabel")
    titleLabel.BackgroundTransparency = 1
    titleLabel.TextColor3 = CONFIG.TEXT_TITLE
    titleLabel.TextSize = 20
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.Text = "Death Ball Exploit"
    titleLabel.Size = UDim2.new(0.5, 0, 1, 0)
    titleLabel.Position = UDim2.new(0.2, 0, 0, 0)
    titleLabel.TextXAlignment = Enum.TextXAlignment.Center
    titleLabel.Parent = header

    -- Close Button
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.BackgroundColor3 = CONFIG.BUTTON_ACCENT_COLOR
    closeButton.BackgroundTransparency = 0.3
    closeButton.TextColor3 = CONFIG.TEXT_COLOR
    closeButton.TextSize = 14
    closeButton.Font = Enum.Font.GothamBold
    closeButton.Text = "X"
    closeButton.BorderSizePixel = 0
    closeButton.Size = UDim2.new(0, 40, 0, 40)
    closeButton.Position = UDim2.new(1, -45, 0.5, -20)
    closeButton.Parent = header

    CreateHoverAnimation(closeButton, CONFIG.BUTTON_ACCENT_COLOR, Color3.fromRGB(255, 100, 100))

    -- ========== SIDEBAR ==========
    local sidebar = Instance.new("Frame")
    sidebar.Name = "Sidebar"
    sidebar.BackgroundColor3 = CONFIG.SIDEBAR_COLOR
    sidebar.BorderSizePixel = 0
    sidebar.Size = UDim2.new(0, CONFIG.SIDEBAR_WIDTH, 1, -50)
    sidebar.Position = UDim2.new(0, 0, 0, 50)
    sidebar.Parent = mainPanel

    -- Tabs
    local tabs = {"Home", "Combat", "Render", "Settings"}
    local tabButtons = {}

    for idx, tabName in ipairs(tabs) do
        local tabButton = Instance.new("TextButton")
        tabButton.Name = tabName .. "_Tab"
        tabButton.BackgroundColor3 = CONFIG.BUTTON_COLOR
        tabButton.BackgroundTransparency = 0.4
        tabButton.TextColor3 = CONFIG.TEXT_COLOR
        tabButton.TextSize = 12
        tabButton.Font = Enum.Font.GothamBold
        tabButton.Text = tabName
        tabButton.BorderSizePixel = 0
        tabButton.Size = UDim2.new(1, -10, 0, 40)
        tabButton.Position = UDim2.new(0, 5, 0, (idx - 1) * 45 + 10)
        tabButton.Parent = sidebar

        local tabCorner = Instance.new("UICorner")
        tabCorner.CornerRadius = UDim.new(0, 5)
        tabCorner.Parent = tabButton

        CreateHoverAnimation(tabButton, CONFIG.BUTTON_COLOR, CONFIG.BUTTON_HOVER_COLOR)

        tabButton.MouseButton1Click:Connect(function()
            ScriptState.CurrentTab = tabName
        end)

        table.insert(tabButtons, {Button = tabButton, Name = tabName})
    end

    -- ========== CONTENT AREA ==========
    local contentArea = Instance.new("Frame")
    contentArea.Name = "ContentArea"
    contentArea.BackgroundTransparency = 1
    contentArea.BorderSizePixel = 0
    contentArea.Size = UDim2.new(1, -CONFIG.SIDEBAR_WIDTH, 1, -50)
    contentArea.Position = UDim2.new(0, CONFIG.SIDEBAR_WIDTH, 0, 50)
    contentArea.Parent = mainPanel

    -- ===== HOME TAB CONTENT =====
    local homeContent = Instance.new("Frame")
    homeContent.Name = "HomeContent"
    homeContent.BackgroundTransparency = 1
    homeContent.BorderSizePixel = 0
    homeContent.Size = UDim2.new(1, 0, 1, 0)
    homeContent.Parent = contentArea

    -- Feature 1: Auto Parry
    local autoParryFrame = Instance.new("Frame")
    autoParryFrame.Name = "AutoParryFrame"
    autoParryFrame.BackgroundColor3 = CONFIG.BUTTON_COLOR
    autoParryFrame.BackgroundTransparency = 0.3
    autoParryFrame.BorderSizePixel = 0
    autoParryFrame.Size = UDim2.new(0.45, 0, 0, 70)
    autoParryFrame.Position = UDim2.new(0, 15, 0, 20)
    autoParryFrame.Parent = homeContent

    local autoParryCorner = Instance.new("UICorner")
    autoParryCorner.CornerRadius = UDim.new(0, 6)
    autoParryCorner.Parent = autoParryFrame

    local autoParryLabel = Instance.new("TextLabel")
    autoParryLabel.BackgroundTransparency = 1
    autoParryLabel.TextColor3 = CONFIG.TEXT_TITLE
    autoParryLabel.TextSize = 14
    autoParryLabel.Font = Enum.Font.GothamBold
    autoParryLabel.Text = "üîÑ Auto Parry"
    autoParryLabel.Size = UDim2.new(1, -20, 0.4, 0)
    autoParryLabel.Position = UDim2.new(0, 10, 0, 5)
    autoParryLabel.TextXAlignment = Enum.TextXAlignment.Left
    autoParryLabel.Parent = autoParryFrame

    local autoParryStatus = Instance.new("TextLabel")
    autoParryStatus.Name = "Status"
    autoParryStatus.BackgroundTransparency = 1
    autoParryStatus.TextColor3 = Color3.fromRGB(150, 150, 150)
    autoParryStatus.TextSize = 11
    autoParryStatus.Font = Enum.Font.Gotham
    autoParryStatus.Text = "Status: OFF"
    autoParryStatus.Size = UDim2.new(1, -20, 0.3, 0)
    autoParryStatus.Position = UDim2.new(0, 10, 0.4, 0)
    autoParryStatus.TextXAlignment = Enum.TextXAlignment.Left
    autoParryStatus.Parent = autoParryFrame

    -- Bot√£o ON/OFF Auto Parry
    local autoParryToggle = Instance.new("TextButton")
    autoParryToggle.Name = "AutoParryToggle"
    autoParryToggle.BackgroundColor3 = CONFIG.BUTTON_ACCENT_COLOR
    autoParryToggle.BackgroundTransparency = 0.3
    autoParryToggle.TextColor3 = CONFIG.TEXT_COLOR
    autoParryToggle.TextSize = 11
    autoParryToggle.Font = Enum.Font.GothamBold
    autoParryToggle.Text = "OFF"
    autoParryToggle.BorderSizePixel = 0
    autoParryToggle.Size = UDim2.new(0, 45, 0, 25)
    autoParryToggle.Position = UDim2.new(1, -60, 0.5, -12)
    autoParryToggle.Parent = autoParryFrame

    local autoParryToggleCorner = Instance.new("UICorner")
    autoParryToggleCorner.CornerRadius = UDim.new(0, 4)
    autoParryToggleCorner.Parent = autoParryToggle

    local autoParryEnabled = false

    autoParryToggle.MouseButton1Click:Connect(function()
        autoParryEnabled = not autoParryEnabled
        ScriptState.AutoParryEnabled = autoParryEnabled
        autoParryToggle.Text = autoParryEnabled and "ON" or "OFF"
        autoParryToggle.BackgroundColor3 = autoParryEnabled and CONFIG.SUCCESS_COLOR or CONFIG.BUTTON_ACCENT_COLOR
        autoParryStatus.Text = "Status: " .. (autoParryEnabled and "‚úì ON" or "‚úï OFF")
        autoParryStatus.TextColor3 = autoParryEnabled and CONFIG.SUCCESS_COLOR or Color3.fromRGB(200, 100, 100)
    end)

    CreateHoverAnimation(autoParryToggle, CONFIG.BUTTON_ACCENT_COLOR, Color3.fromRGB(255, 100, 100))

    -- Feature 2: ESP View
    local espViewFrame = Instance.new("Frame")
    espViewFrame.Name = "ESPViewFrame"
    espViewFrame.BackgroundColor3 = CONFIG.BUTTON_COLOR
    espViewFrame.BackgroundTransparency = 0.3
    espViewFrame.BorderSizePixel = 0
    espViewFrame.Size = UDim2.new(0.45, 0, 0, 70)
    espViewFrame.Position = UDim2.new(0.55, 0, 0, 20)
    espViewFrame.Parent = homeContent

    local espViewCorner = Instance.new("UICorner")
    espViewCorner.CornerRadius = UDim.new(0, 6)
    espViewCorner.Parent = espViewFrame

    local espViewLabel = Instance.new("TextLabel")
    espViewLabel.BackgroundTransparency = 1
    espViewLabel.TextColor3 = CONFIG.TEXT_TITLE
    espViewLabel.TextSize = 14
    espViewLabel.Font = Enum.Font.GothamBold
    espViewLabel.Text = "üëÅÔ∏è ESP View"
    espViewLabel.Size = UDim2.new(1, -20, 0.4, 0)
    espViewLabel.Position = UDim2.new(0, 10, 0, 5)
    espViewLabel.TextXAlignment = Enum.TextXAlignment.Left
    espViewLabel.Parent = espViewFrame

    local espViewStatus = Instance.new("TextLabel")
    espViewStatus.Name = "Status"
    espViewStatus.BackgroundTransparency = 1
    espViewStatus.TextColor3 = Color3.fromRGB(150, 150, 150)
    espViewStatus.TextSize = 11
    espViewStatus.Font = Enum.Font.Gotham
    espViewStatus.Text = "Status: OFF"
    espViewStatus.Size = UDim2.new(1, -20, 0.3, 0)
    espViewStatus.Position = UDim2.new(0, 10, 0.4, 0)
    espViewStatus.TextXAlignment = Enum.TextXAlignment.Left
    espViewStatus.Parent = espViewFrame

    local espViewToggle = Instance.new("TextButton")
    espViewToggle.Name = "ESPViewToggle"
    espViewToggle.BackgroundColor3 = CONFIG.BUTTON_ACCENT_COLOR
    espViewToggle.BackgroundTransparency = 0.3
    espViewToggle.TextColor3 = CONFIG.TEXT_COLOR
    espViewToggle.TextSize = 11
    espViewToggle.Font = Enum.Font.GothamBold
    espViewToggle.Text = "OFF"
    espViewToggle.BorderSizePixel = 0
    espViewToggle.Size = UDim2.new(0, 45, 0, 25)
    espViewToggle.Position = UDim2.new(1, -60, 0.5, -12)
    espViewToggle.Parent = espViewFrame

    local espViewToggleCorner = Instance.new("UICorner")
    espViewToggleCorner.CornerRadius = UDim.new(0, 4)
    espViewToggleCorner.Parent = espViewToggle

    local espViewEnabled = false

    espViewToggle.MouseButton1Click:Connect(function()
        espViewEnabled = not espViewEnabled
        ScriptState.ESPViewEnabled = espViewEnabled
        espViewToggle.Text = espViewEnabled and "ON" or "OFF"
        espViewToggle.BackgroundColor3 = espViewEnabled and CONFIG.SUCCESS_COLOR or CONFIG.BUTTON_ACCENT_COLOR
        espViewStatus.Text = "Status: " .. (espViewEnabled and "‚úì ON" or "‚úï OFF")
        espViewStatus.TextColor3 = espViewEnabled and CONFIG.SUCCESS_COLOR or Color3.fromRGB(200, 100, 100)
    end)

    CreateHoverAnimation(espViewToggle, CONFIG.BUTTON_ACCENT_COLOR, Color3.fromRGB(255, 100, 100))

    -- Feature 3: ESP Line
    local espLineFrame = Instance.new("Frame")
    espLineFrame.Name = "ESPLineFrame"
    espLineFrame.BackgroundColor3 = CONFIG.BUTTON_COLOR
    espLineFrame.BackgroundTransparency = 0.3
    espLineFrame.BorderSizePixel = 0
    espLineFrame.Size = UDim2.new(0.45, 0, 0, 70)
    espLineFrame.Position = UDim2.new(0, 15, 0, 110)
    espLineFrame.Parent = homeContent

    local espLineCorner = Instance.new("UICorner")
    espLineCorner.CornerRadius = UDim.new(0, 6)
    espLineCorner.Parent = espLineFrame

    local espLineLabel = Instance.new("TextLabel")
    espLineLabel.BackgroundTransparency = 1
    espLineLabel.TextColor3 = CONFIG.TEXT_TITLE
    espLineLabel.TextSize = 14
    espLineLabel.Font = Enum.Font.GothamBold
    espLineLabel.Text = "üìç ESP Line"
    espLineLabel.Size = UDim2.new(1, -20, 0.4, 0)
    espLineLabel.Position = UDim2.new(0, 10, 0, 5)
    espLineLabel.TextXAlignment = Enum.TextXAlignment.Left
    espLineLabel.Parent = espLineFrame

    local espLineStatus = Instance.new("TextLabel")
    espLineStatus.Name = "Status"
    espLineStatus.BackgroundTransparency = 1
    espLineStatus.TextColor3 = Color3.fromRGB(150, 150, 150)
    espLineStatus.TextSize = 11
    espLineStatus.Font = Enum.Font.Gotham
    espLineStatus.Text = "Status: OFF"
    espLineStatus.Size = UDim2.new(1, -20, 0.3, 0)
    espLineStatus.Position = UDim2.new(0, 10, 0.4, 0)
    espLineStatus.TextXAlignment = Enum.TextXAlignment.Left
    espLineStatus.Parent = espLineFrame

    local espLineToggle = Instance.new("TextButton")
    espLineToggle.Name = "ESPLineToggle"
    espLineToggle.BackgroundColor3 = CONFIG.BUTTON_ACCENT_COLOR
    espLineToggle.BackgroundTransparency = 0.3
    espLineToggle.TextColor3 = CONFIG.TEXT_COLOR
    espLineToggle.TextSize = 11
    espLineToggle.Font = Enum.Font.GothamBold
    espLineToggle.Text = "OFF"
    espLineToggle.BorderSizePixel = 0
    espLineToggle.Size = UDim2.new(0, 45, 0, 25)
    espLineToggle.Position = UDim2.new(1, -60, 0.5, -12)
    espLineToggle.Parent = espLineFrame

    local espLineToggleCorner = Instance.new("UICorner")
    espLineToggleCorner.CornerRadius = UDim.new(0, 4)
    espLineToggleCorner.Parent = espLineToggle

    local espLineEnabled = false

    espLineToggle.MouseButton1Click:Connect(function()
        espLineEnabled = not espLineEnabled
        ScriptState.ESPLineEnabled = espLineEnabled
        espLineToggle.Text = espLineEnabled and "ON" or "OFF"
        espLineToggle.BackgroundColor3 = espLineEnabled and CONFIG.SUCCESS_COLOR or CONFIG.BUTTON_ACCENT_COLOR
        espLineStatus.Text = "Status: " .. (espLineEnabled and "‚úì ON" or "‚úï OFF")
        espLineStatus.TextColor3 = espLineEnabled and CONFIG.SUCCESS_COLOR or Color3.fromRGB(200, 100, 100)
    end)

    CreateHoverAnimation(espLineToggle, CONFIG.BUTTON_ACCENT_COLOR, Color3.fromRGB(255, 100, 100))

    -- Info Box
    local infoBox = Instance.new("Frame")
    infoBox.Name = "InfoBox"
    infoBox.BackgroundColor3 = CONFIG.BUTTON_COLOR
    infoBox.BackgroundTransparency = 0.4
    infoBox.BorderSizePixel = 0
    infoBox.Size = UDim2.new(1, -30, 0, 90)
    infoBox.Position = UDim2.new(0, 15, 1, -110)
    infoBox.Parent = homeContent

    local infoCorner = Instance.new("UICorner")
    infoCorner.CornerRadius = UDim.new(0, 6)
    infoCorner.Parent = infoBox

    local infoTitle = Instance.new("TextLabel")
    infoTitle.BackgroundTransparency = 1
    infoTitle.TextColor3 = CONFIG.ACCENT_COLOR
    infoTitle.TextSize = 12
    infoTitle.Font = Enum.Font.GothamBold
    infoTitle.Text = "‚ÑπÔ∏è INFORMA√á√ïES"
    infoTitle.Size = UDim2.new(1, 0, 0.3, 0)
    infoTitle.TextXAlignment = Enum.TextXAlignment.Left
    infoTitle.Position = UDim2.new(0, 10, 0, 5)
    infoTitle.Parent = infoBox

    local infoText = Instance.new("TextLabel")
    infoText.BackgroundTransparency = 1
    infoText.TextColor3 = CONFIG.TEXT_COLOR
    infoText.TextSize = 11
    infoText.Font = Enum.Font.Gotham
    infoText.Text = "Pressione 'B' para abrir/fechar\nTodas as features est√£o desativadas\nAnima√ß√µes suaves em todos os bot√µes"
    infoText.Size = UDim2.new(1, -20, 0.6, 0)
    infoText.Position = UDim2.new(0, 10, 0.3, 0)
    infoText.TextXAlignment = Enum.TextXAlignment.Left
    infoText.TextWrapped = true
    infoText.Parent = infoBox

    -- Drag functionality
    local dragging = false
    local dragStart = Vector2.new(0, 0)
    local startPos = mainPanel.Position

    header.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = game:GetService("UserInputService"):GetMouseLocation()
            startPos = mainPanel.Position
        end
    end)

    header.InputEnded:Connect(function(input, gameProcessed)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)

    game:GetService("UserInputService").InputChanged:Connect(function(input, gameProcessed)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local currentMouse = game:GetService("UserInputService"):GetMouseLocation()
            local delta = currentMouse - dragStart
            mainPanel.Position = UDim2.new(0, startPos.X.Offset + delta.X, 0, startPos.Y.Offset + delta.Y)
        end
    end)

    -- Close button functionality
    closeButton.MouseButton1Click:Connect(function()
        screenGui:Destroy()
    end)

    return screenGui, mainPanel
end

-- ============================================================================
-- KEYBIND PARA ABRIR/FECHAR PAINEL
-- ============================================================================

local screenGui, mainPanel = nil, nil

local function SetupKeybind()
    local userInputService = game:GetService("UserInputService")
    
    userInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        if input.KeyCode == CONFIG.TOGGLE_PANEL_KEY then
            if mainPanel then
                ScriptState.PanelVisible = not ScriptState.PanelVisible
                mainPanel.Visible = ScriptState.PanelVisible
            end
        end
    end)
end

-- ============================================================================
-- MAIN LOOP
-- ============================================================================

local function MainLoop()
    while true do
        SafeCall(function()
            AutoParryLogic()
            UpdateESPDrawings()
        end)
        wait(0.1)
    end
end

-- ============================================================================
-- INICIALIZA√á√ÉO
-- ============================================================================

if not game:IsLoaded() then
    game.Loaded:Wait()
end

wait(2)

print("‚úì Iniciando Death Ball Script v3.0 (Novo Design)...")

screenGui, mainPanel = CreateUI()

print("‚úì GUI criada com novo design!")
print("‚úì Keybind: Pressione 'B' para abrir/fechar")
print("‚úì Painel arrast√°vel pela barra de t√≠tulo")

SetupKeybind()

task.spawn(MainLoop)

print("‚úì Death Ball Script v3.0 carregado com sucesso!")

game.Players.LocalPlayer.CharacterAdded:Connect(function()
    CleanupESP()
end)
